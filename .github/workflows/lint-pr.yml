name: Lint PR

on:
  pull_request:

permissions: {}

jobs:
  main:
    name: Validate PR title
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v6
        with:
          script: |
            const title = context.payload.pull_request.title;
            console.log(JSON.stringify(context.payload))

            const allowedTypes = ["chore", "feat", "fix", "refactor", "test", "revert"];

            const matchesType = allowedTypes.some( type => title.startsWith(type + ":") );

            if(!matchesType) {
              console.log(`PR title does follow the convention "type: subject". Allowed types are:`, allowedTypes.join(", "))
              process.exitCode = 1;
            }
